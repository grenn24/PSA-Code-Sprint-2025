{"version":3,"file":"db.js","sourceRoot":"","sources":["../../startup/db.ts"],"names":[],"mappings":"AAAA,OAAO,QAAQ,MAAM,UAAU,CAAC;AAChC,OAAO,MAAM,MAAM,QAAQ,CAAC;AAC5B,OAAO,WAAW,MAAM,OAAO,CAAC;AAEhC,OAAO,MAAM,MAAM,yBAAyB,CAAC;AAE7C,MAAM,OAAO,GAAG,WAAW,CAAC,IAAI,CAAC,CAAC;AAClC,MAAM,cAAc,GAAG,WAAW,CAAC,YAAY,CAAC,CAAC;AAEjD,uEAAuE;AACvE,MAAM,EAAE,GAAG,KAAK,EAAE,GAAa,EAAE,EAAE;IAClC,IAAI,CAAC;QACJ,MAAM,IAAI,GAAG,MAAM,QAAQ,CAAC,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC,CAAC;QAChE,cAAc,CACb,4BAA4B,MAAM,CAAC,GAAG,CAAC,cAAc,CAAC,EAAE,CACxD,CAAC;QACF,IAAI,GAAG,EAAE,CAAC;YACT,GAAG,CAAC,MAAM,CAAC,EAAE,GAAG,IAAI,CAAC,UAAU,CAAC;QACjC,CAAC;QACD,OAAO,IAAI,CAAC,UAAU,CAAC;IACxB,CAAC;IAAC,OAAO,GAAG,EAAE,CAAC;QACd,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;QACjB,OAAO,CAAC,GAAG,CAAC,CAAC;QACb,MAAM,CAAC,cAAc,CAAC,CAAC,OAAO,CAAC,GAAG,CAAC,CAAC;IACrC,CAAC;AACF,CAAC,CAAC;AAEF,eAAe,EAAE,CAAC","sourcesContent":["import mongoose from \"mongoose\";\r\nimport config from \"config\";\r\nimport createDebug from \"debug\";\r\nimport { Express } from \"express\";\r\nimport logger from \"../utilities/winston.js\";\r\n\r\nconst dbDebug = createDebug(\"db\");\r\nconst dbStartupDebug = createDebug(\"db:startup\");\r\n\r\n// Establish connection with mongodb, resolves with a mongoose instance\r\nconst db = async (app?: Express) => {\r\n\ttry {\r\n\t\tconst conn = await mongoose.connect(config.get(\"DATABASE_URL\"));\r\n\t\tdbStartupDebug(\r\n\t\t\t`Database is connected at ${config.get(\"DATABASE_URL\")}`\r\n\t\t);\r\n\t\tif (app) {\r\n\t\t\tapp.locals.db = conn.connection;\r\n\t\t}\r\n\t\treturn conn.connection;\r\n\t} catch (err) {\r\n\t\tconsole.log(err);\r\n\t\tdbDebug(err);\r\n\t\tlogger(\"/logs/db.log\").verbose(err);\r\n\t}\r\n};\r\n\r\nexport default db;\r\n"]}